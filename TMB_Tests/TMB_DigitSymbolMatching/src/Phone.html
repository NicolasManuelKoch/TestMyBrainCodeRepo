Qualtrics.SurveyEngine.addOnReady(function () {
  /* ==== CONFIG ==== */
  const hostOrigin = "https://nicolasmanuelkoch.github.io"; // your GitHub Pages origin
  const taskPath   = "/TestMyBrainCodeRepo/TMB_Tests/TMB_DigitSymbolMatching/src/Phone.html";

  /* ==== Mount iframe ==== */
  const pid  = Qualtrics.SurveyEngine.getEmbeddedData("participant_id") || "TESTPID";
  const url  = hostOrigin + taskPath + "?pid=" + encodeURIComponent(pid);
  const qc   = this.getQuestionContainer();
  const ifr  = document.createElement("iframe");
  ifr.id = "dsmFrame";
  ifr.src = url;
  ifr.style.width  = "100%";
  ifr.style.height = "700px";
  ifr.style.border = "0";
  qc.appendChild(ifr);

  console.log("[DSM] iframe src:", url);

  /* ==== Listen for result ==== */
  window.addEventListener("message", function (e) {
    console.log("[DSM] message:", e.origin, e.data);

    // Lock to your host origin
    const allowed = [hostOrigin];
    if (!allowed.includes(e.origin)) return;

    if (!e.data || e.data.type !== "DSM_RESULT") return;

    // Save all fields to Embedded Data
    Qualtrics.SurveyEngine.setEmbeddedData("TMB_pid",      e.data.pid        || "");
    Qualtrics.SurveyEngine.setEmbeddedData("TMB_score",    e.data.score      || "");
    Qualtrics.SurveyEngine.setEmbeddedData("TMB_rt",       e.data.rt         || "");
    Qualtrics.SurveyEngine.setEmbeddedData("TMB_attempts", e.data.attempts   || "");
    Qualtrics.SurveyEngine.setEmbeddedData("TMB_accuracy", e.data.accuracy ?? "");

    this.clickNextButton(); // advance
  }.bind(this), false);
});
